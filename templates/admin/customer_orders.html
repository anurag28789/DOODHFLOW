{% extends "base.html" %}
{% block title %}Current Orders - {{ customer.name }}{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Orders for {{ customer.name }}</h2>
        <a href="{{ url_for('manage_customers') }}" class="btn btn-secondary">Back to All Customers</a>
    </div>

    <!-- Nav tabs -->
    <ul class="nav nav-tabs" id="adminOrderTabs" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active" id="pending-tab" data-bs-toggle="tab" data-bs-target="#pending" type="button" role="tab" aria-controls="pending" aria-selected="true">Pending ({{ grouped_orders.pending|length }})</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="approved-tab" data-bs-toggle="tab" data-bs-target="#approved" type="button" role="tab" aria-controls="approved" aria-selected="false">Approved ({{ grouped_orders.approved|length }})</button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link" id="delivered-tab" data-bs-toggle="tab" data-bs-target="#delivered" type="button" role="tab" aria-controls="delivered" aria-selected="false">Delivered & Unpaid ({{ grouped_orders.delivered_unpaid|length }})</button>
        </li>
    </ul>

    <!-- Tab content -->
    <div class="tab-content" id="adminOrderTabsContent">
        <!-- Pending Tab -->
        <div class="tab-pane fade show active" id="pending" role="tabpanel" aria-labelledby="pending-tab">
            {% with summaries=grouped_orders.pending %}
                {# This now correctly includes the partial from the customer directory #}
                {% include 'customer/_order_table.html' %}
            {% endwith %}
        </div>
        <!-- Approved Tab -->
        <div class="tab-pane fade" id="approved" role="tabpanel" aria-labelledby="approved-tab">
            {% with summaries=grouped_orders.approved %}
                {% include 'customer/_order_table.html' %}
            {% endwith %}
        </div>
        <!-- Delivered & Unpaid Tab -->
        <div class="tab-pane fade" id="delivered" role="tabpanel" aria-labelledby="delivered-tab">
             {% with summaries=grouped_orders.delivered_unpaid %}
                {% include 'customer/_order_table.html' %}
            {% endwith %}
        </div>
    </div>
</div>
{% endblock %}
